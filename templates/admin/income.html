{% extends 'admin/base.html' %}
{% block title %}Income{% endblock %}
{% block page_title %}Income Management{% endblock %}

{% block content %}
<!-- Section Explanation -->
<div class="content-card"
    style="background: linear-gradient(135deg, #38a169 0%, #2f855a 100%); color: white; margin-bottom: 25px;">
    <h2 style="border: none; color: white; margin-bottom: 10px;"><i class="fas fa-arrow-down"></i> Income Management
    </h2>
    <p style="opacity: 0.9; margin: 0;">This section tracks all money coming into your business. Record payments from
        clients here whenever you complete a job or receive a deposit. This helps you see how much money your business
        is making.</p>
</div>

<div class="stats-grid">
    <div class="stat-card income">
        <h3><i class="fas fa-arrow-down"></i> Total Income</h3>
        <div class="value">UGX {{ "{:,.0f}".format(total) }}</div>
        <small class="text-muted">All money received so far</small>
    </div>
</div>

<div class="content-card">
    <h2><i class="fas fa-plus-circle"></i> Add New Income</h2>
    <p class="text-muted" style="margin-bottom: 20px;"><strong>How to use:</strong> Fill in the form below whenever a
        client pays you. Select the date of payment, choose the type of service, enter the amount in Uganda Shillings,
        and add a short description (like the client's name).</p>
    <form action="{{ url_for('admin.add_income') }}" method="POST">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <div class="form-row">
            <div class="form-group">
                <label for="date">Date <small style="color: #718096;">(When did you receive the
                        payment?)</small></label>
                <input type="date" id="date" name="date" required>
            </div>
            <div class="form-group">
                <label for="category">Category <small style="color: #718096;">(What service was it for?)</small></label>
                <select id="category" name="category" required>
                    <option value="">Select category</option>
                    <optgroup label="EVENTS &amp; CELEBRATIONS">
                        <option value="Wedding Photography">Wedding Photography</option>
                        <option value="Kukyala Coverage">Kukyala Coverage</option>
                        <option value="Birthday Photography">Birthday Photography</option>
                        <option value="Baby Shoot">Baby Shoot</option>
                        <option value="Graduation Photography">Graduation Photography</option>
                        <option value="Party & Social Events">Party &amp; Social Events</option>
                    </optgroup>
                    <optgroup label="CORPORATE &amp; BUSINESS">
                        <option value="Corporate Events">Corporate Events</option>
                        <option value="Corporate Portraits">Corporate Portraits</option>
                        <option value="Business Branding">Business Branding</option>
                        <option value="Conferences & Seminars">Conferences &amp; Seminars</option>
                        <option value="Award Ceremonies">Award Ceremonies</option>
                    </optgroup>
                    <optgroup label="RELIGIOUS &amp; COMMUNITY">
                        <option value="Church Events">Church Events</option>
                        <option value="Baptism & Dedication">Baptism &amp; Dedication</option>
                        <option value="Community Events">Community Events</option>
                        <option value="Cultural Ceremonies">Cultural Ceremonies</option>
                    </optgroup>
                    <optgroup label="LIFESTYLE &amp; STUDIO">
                        <option value="Portrait Session">Portrait Session</option>
                        <option value="Family Photography">Family Photography</option>
                        <option value="Couple & Engagement">Couple &amp; Engagement</option>
                        <option value="Studio Session">Studio Session</option>
                        <option value="Passport & ID Photos">Passport &amp; ID Photos</option>
                    </optgroup>
                    <optgroup label="MEDIA &amp; CREATIVE">
                        <option value="Video Production">Video Production</option>
                        <option value="Graphics Design">Graphics Design</option>
                        <option value="Photo & Video Editing">Photo &amp; Video Editing</option>
                        <option value="Documentaries & Short Films">Documentaries &amp; Short Films</option>
                    </optgroup>
                    <optgroup label="COMMERCIAL &amp; MARKETING">
                        <option value="Product Photography">Product Photography</option>
                        <option value="Food Photography">Food Photography</option>
                        <option value="Real Estate Photography">Real Estate Photography</option>
                        <option value="Advertising & Campaigns">Advertising &amp; Campaigns</option>
                    </optgroup>
                    <optgroup label="OTHERS">
                        <option value="Photo Printing">Photo Printing</option>
                        <option value="Ordinary Photos">Ordinary Photos</option>
                        <option value="Passport Express">Passport Express</option>
                    </optgroup>
                    <option value="Other">Other</option>
                </select>
            </div>
            <div class="form-group">
                <label for="amount">Amount (UGX) <small style="color: #718096;">(How much did they pay?)</small></label>
                <input type="number" id="amount" name="amount" min="0" step="1000" placeholder="e.g., 500000" required>
            </div>
        </div>
        <div class="form-group">
            <label for="description">Description <small style="color: #718096;">(Who paid and for what?)</small></label>
            <input type="text" id="description" name="description"
                placeholder="e.g., Wedding photography for John & Mary - Full payment" required>
        </div>
        <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Add Income</button>
    </form>
</div>

<div class="content-card">
    <h2><i class="fas fa-list"></i> Income Records</h2>
    <p class="text-muted" style="margin-bottom: 20px;">All your income entries are listed below. You can delete any
        record by clicking the red trash button (be careful, this cannot be undone!).</p>
    {% if records %}
    <table>
        <thead>
            <tr>
                <th>Date</th>
                <th>Description</th>
                <th>Category</th>
                <th>Amount</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for r in records %}
            <tr>
                <td>{{ r['date'] }}</td>
                <td>{{ r['description'] }}</td>
                <td>{{ r['category'] }}</td>
                <td class="text-success">UGX {{ "{:,.0f}".format(r['amount']) }}</td>
                <td>
                    <form action="{{ url_for('admin.delete_income', id=r['id']) }}" method="POST" style="display: inline;"
                        onsubmit="return confirm('Are you sure you want to delete this income record? This cannot be undone.')">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <button type="submit" class="btn btn-danger btn-sm"><i class="fas fa-trash"></i></button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="text-muted">No income records yet. Use the form above to add your first income entry!</p>
    {% endif %}
</div>
{% endblock %}
