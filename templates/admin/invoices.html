{% extends 'admin/base.html' %}
{% block title %}Invoices{% endblock %}
{% block page_title %}Invoice Management{% endblock %}

{% block content %}
<!-- Section Explanation -->
<div class="content-card"
    style="background: linear-gradient(135deg, #3182ce 0%, #2b6cb0 100%); color: white; margin-bottom: 25px;">
    <h2 style="border: none; color: white; margin-bottom: 10px;"><i class="fas fa-file-invoice"></i> Invoice Management
    </h2>
    <p style="opacity: 0.9; margin: 0;">Create professional invoices for your clients here. Invoices are formal
        documents that show what you're charging a client for. You can track which invoices have been paid and which are
        still pending.</p>
</div>

<div class="content-card">
    <h2><i class="fas fa-file-invoice"></i> Create New Invoice</h2>
    <p class="text-muted" style="margin-bottom: 20px;"><strong>How to use:</strong> First, make sure you've added the
        customer in the Customers section. Then select them here, enter the date and amount, and create the invoice. The
        invoice number is generated automatically.</p>
    <form action="{{ url_for('admin.add_invoice') }}" method="POST">
        <div class="form-row">
            <div class="form-group">
                <label for="invoice_number">Invoice Number <small
                        style="color: #718096;">(Auto-generated)</small></label>
                <input type="text" id="invoice_number" name="invoice_number" value="{{ next_invoice_number }}" required>
            </div>
            <div class="form-group">
                <label for="customer_id">Customer <small style="color: #718096;">(Who is this invoice
                        for?)</small></label>
                <select id="customer_id" name="customer_id" required>
                    <option value="">Select customer</option>
                    {% for c in customers %}
                    <option value="{{ c['id'] }}">{{ c['name'] }} - {{ c['service'] }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label for="date">Date <small style="color: #718096;">(Invoice date)</small></label>
                <input type="date" id="date" name="date" required>
            </div>
            <div class="form-group">
                <label for="amount">Amount (UGX) <small style="color: #718096;">(Total to charge)</small></label>
                <input type="number" id="amount" name="amount" min="0" step="1000" placeholder="e.g., 800000" required>
            </div>
        </div>
        <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Create Invoice</button>
    </form>
</div>

<div class="content-card">
    <h2><i class="fas fa-list"></i> Invoice List</h2>
    <p class="text-muted" style="margin-bottom: 20px;">All your invoices are listed below. Click <strong>"Mark
            Paid"</strong> when a client pays an invoice. <strong>Green = Paid</strong>, <strong>Yellow = Still waiting
            for payment</strong>.</p>
    {% if records %}
    <table>
        <thead>
            <tr>
                <th>Invoice #</th>
                <th>Customer</th>
                <th>Date</th>
                <th>Amount</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for r in records %}
            <tr>
                <td><strong>{{ r['invoice_number'] }}</strong></td>
                <td>{{ r['customer_name'] }}</td>
                <td>{{ r['date'] }}</td>
                <td>UGX {{ "{:,.0f}".format(r['amount']) }}</td>
                <td>
                    {% if r['status'] == 'Paid' %}
                    <span class="badge badge-success">Paid âœ“</span>
                    {% else %}
                    <span class="badge badge-warning">Pending</span>
                    {% endif %}
                </td>
                <td>
                    {% if r['status'] != 'Paid' %}
                    <a href="{{ url_for('admin.mark_invoice_paid', id=r['id']) }}" class="btn btn-success btn-sm"><i
                            class="fas fa-check"></i> Mark Paid</a>
                    {% endif %}
                    <a href="{{ url_for('admin.delete_invoice', id=r['id']) }}" class="btn btn-danger btn-sm"
                        onclick="return confirm('Are you sure you want to delete this invoice?')"><i
                            class="fas fa-trash"></i></a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="text-muted">No invoices yet. First add customers in the Customers section, then you can create invoices
        for them here.</p>
    {% endif %}
</div>
{% endblock %}