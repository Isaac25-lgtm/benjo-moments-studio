{% extends 'admin/base.html' %}
{% block title %}Customers{% endblock %}
{% block page_title %}Customers Management{% endblock %}

{% block content %}
<!-- Section Explanation -->
<div class="content-card"
    style="background: linear-gradient(135deg, #805ad5 0%, #6b46c1 100%); color: white; margin-bottom: 25px;">
    <h2 style="border: none; color: white; margin-bottom: 10px;"><i class="fas fa-users"></i> Customers Management</h2>
    <p style="opacity: 0.9; margin: 0;">This section helps you track your clients and their payments. Add each client
        here with their service details and payment information. The system will automatically calculate how much each
        client still owes you.</p>
</div>

<div class="stats-grid">
    <div class="stat-card">
        <h3><i class="fas fa-clock"></i> Total Pending Balance</h3>
        <div class="value">UGX {{ "{:,.0f}".format(total_pending) }}</div>
        <small class="text-muted">Total money clients still owe you</small>
    </div>
</div>

<div class="content-card">
    <h2><i class="fas fa-user-plus"></i> Add New Customer</h2>
    <p class="text-muted" style="margin-bottom: 20px;"><strong>How to use:</strong> When you book a new client, add them
        here. Enter their name, contact info, the service they booked, the total price agreed upon, and how much they've
        paid so far (like a deposit).</p>
    <form action="{{ url_for('admin.add_customer') }}" method="POST">
        <div class="form-row">
            <div class="form-group">
                <label for="name">Customer Name <small style="color: #718096;">(Full name of the client)</small></label>
                <input type="text" id="name" name="name" placeholder="e.g., John Mukasa" required>
            </div>
            <div class="form-group">
                <label for="contact">Contact <small style="color: #718096;">(Phone number to reach them)</small></label>
                <input type="text" id="contact" name="contact" placeholder="+256 7xx xxx xxx">
            </div>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label for="service">Service <small style="color: #718096;">(What did they book?)</small></label>
                <select id="service" name="service" required>
                    <option value="">Select service</option>
                    <option value="Wedding Photography">Wedding Photography</option>
                    <option value="Kukyala Coverage">Kukyala Coverage</option>
                    <option value="Birthday Shoot">Birthday Shoot</option>
                    <option value="Baby Shoot">Baby Shoot</option>
                    <option value="Portrait Session">Portrait Session</option>
                    <option value="Event Coverage">Event Coverage</option>
                    <option value="Video Production">Video Production</option>
                    <option value="Full Package">Full Package (Photo + Video)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="total_amount">Total Amount (UGX) <small style="color: #718096;">(Full price
                        agreed)</small></label>
                <input type="number" id="total_amount" name="total_amount" min="0" step="1000"
                    placeholder="e.g., 1500000" required>
            </div>
            <div class="form-group">
                <label for="amount_paid">Amount Paid (UGX) <small style="color: #718096;">(Deposit received so
                        far)</small></label>
                <input type="number" id="amount_paid" name="amount_paid" min="0" step="1000" value="0"
                    placeholder="e.g., 500000">
            </div>
        </div>
        <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Add Customer</button>
    </form>
</div>

<div class="content-card">
    <h2><i class="fas fa-users"></i> Customer List</h2>
    <p class="text-muted" style="margin-bottom: 20px;">All your customers are listed below. <strong>Green
            "Paid"</strong> means they've paid in full. <strong>Yellow "Pending"</strong> means they still owe you
        money. The Balance column shows how much they still need to pay.</p>
    {% if records %}
    <table>
        <thead>
            <tr>
                <th>Name</th>
                <th>Service</th>
                <th>Contact</th>
                <th>Total Price</th>
                <th>Paid So Far</th>
                <th>Balance Due</th>
                <th>Status</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for r in records %}
            {% set balance = r['total_amount'] - r['amount_paid'] %}
            <tr>
                <td><strong>{{ r['name'] }}</strong></td>
                <td>{{ r['service'] }}</td>
                <td>{{ r['contact'] or '-' }}</td>
                <td>UGX {{ "{:,.0f}".format(r['total_amount']) }}</td>
                <td class="text-success">UGX {{ "{:,.0f}".format(r['amount_paid']) }}</td>
                <td class="{% if balance > 0 %}text-danger{% else %}text-success{% endif %}">
                    UGX {{ "{:,.0f}".format(balance) }}
                </td>
                <td>
                    {% if balance <= 0 %} <span class="badge badge-success">Paid âœ“</span>
                        {% else %}
                        <span class="badge badge-warning">Pending</span>
                        {% endif %}
                </td>
                <td>
                    <a href="{{ url_for('admin.delete_customer', id=r['id']) }}" class="btn btn-danger btn-sm"
                        onclick="return confirm('Are you sure you want to delete this customer?')"><i
                            class="fas fa-trash"></i></a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="text-muted">No customers yet. Add your first customer using the form above when you book a new client!</p>
    {% endif %}
</div>
{% endblock %}