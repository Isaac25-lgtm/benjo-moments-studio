# Deploying Benjo Moments to Render

## One-click deploy

Click **New → Blueprint** in the Render dashboard and connect the `Isaac25-lgtm/benjo-moments-studio` GitHub repo.
Render will read `render.yaml` and provision the web service + persistent disk automatically.

---

## Required environment variables

Set these in the Render dashboard under **Environment** before the first deploy:

| Variable | Where to get it |
|----------|-----------------|
| `DATABASE_URL` | Neon dashboard → Connection string. Must include `?sslmode=require`. Format: `postgresql+psycopg2://user:pass@host.neon.tech/dbname?sslmode=require` |
| `DEFAULT_ADMIN_EMAIL` | Your studio admin email (e.g. `owner@studio.com`) |
| `DEFAULT_ADMIN_PASSWORD` | A strong password — **never commit this to git** |

`SECRET_KEY` is auto-generated by Render (`generateValue: true`).

---

## How migrations work

`preDeployCommand: alembic upgrade head` runs **once before each deploy**, before any traffic hits the new instance.
No manual migration steps are needed on subsequent deploys.

For the very first deploy on a fresh Neon database, Alembic will create all tables automatically.

---

## Persistent uploads

Uploaded gallery images and hero images are stored on a 1 GB Render Disk mounted at:

```
/opt/render/project/data/uploads
```

This path **persists across deploys**. The `UPLOAD_FOLDER` env var is pre-set to this path in `render.yaml`.

---

## Optional settings

| Variable | Default | Purpose |
|----------|---------|---------|
| `TEST_AUTH_MODE` | `false` | Keep `false` in production. Set `true` only for sandboxed demos. |
| `TEST_PIN` | *(unset)* | If `TEST_AUTH_MODE=true`, restrict login to this PIN only. |
| `REDIS_URL` | *(unset)* | Redis connection for persistent rate limiting across workers. Falls back to in-memory if unset. |

---

## Checking deploy logs

- **Build log** — `pip install -r requirements.txt`
- **Pre-deploy log** — `alembic upgrade head` output
- **Runtime log** — gunicorn startup and request logs
